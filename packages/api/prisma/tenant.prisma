// =================================================================
// ||                TENANT TEMPLATE PRISMA SCHEMA                ||
// =================================================================
// This file is a TEMPLATE. It defines the database structure for a
// SINGLE e-commerce store. It will be replicated into a new
// PostgreSQL schema for each new tenant during onboarding.

generator tenant_template_generator {
  provider = "prisma-client-js"
  // This output is for reference and to help create migrations.
  // It will NOT be used directly in the running application.
  output   = "../generated/tenant"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===============================================
// Models for each tenant's schema
// ===============================================

model Product {
  id                String  @id @default(cuid())
  name              String
  slug              String  @unique
  description       String? @db.Text 
  price             Decimal @db.Decimal(10, 2) 
  sku               String? @unique
  inventoryQuantity Int     @default(0)
  isFeatured        Boolean @default(false)
  isActive          Boolean @default(true)

  images Json @default("[]")

  categories ProductCategory[]
  variants   ProductVariant[]
  orderItems OrderItem[]
  reviews    Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("products")
}

model Category {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?

  products ProductCategory[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("categories")
}

model ProductCategory {
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId  String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId String

  @@id([productId, categoryId])
  @@map("product_categories")
}

model ProductVariant {
  id                String  @id @default(cuid())
  product           Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId         String
  name              String
  sku               String? @unique
  inventoryQuantity Int     @default(0)

  price Decimal? @db.Decimal(10, 2) 

  attributes Json @default("{}")

  orderItems OrderItem[]

  @@map("product_variants")
}

model Order {
  id             String        @id @default(cuid())
  orderSequence  Int
  orderNumber    String        @unique
  status         OrderStatus   @default(PENDING)
  paymentStatus  PaymentStatus @default(PENDING)
  totalAmount    Decimal       @db.Decimal(10, 2) 
  subtotal       Decimal       @db.Decimal(10, 2) 
  taxAmount      Decimal       @db.Decimal(10, 2) @default(0) 
  shippingAmount Decimal       @db.Decimal(10, 2) @default(0) 
  notes          String?

  shippingAddress Json
  billingAddress  Json

  items      OrderItem[]
  customer   Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)
  customerId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([orderSequence])
  @@map("orders")
}

model OrderItem {
  id          String  @id @default(cuid())
  quantity    Int
  unitPrice   Decimal @db.Decimal(10, 2) 

  productName String
  variantName String?
  sku         String?
  image       String?

  order     Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId   String
  product   Product?        @relation(fields: [productId], references: [id], onDelete: SetNull)
  productId String?
  variant   ProductVariant? @relation(fields: [variantId], references: [id], onDelete: SetNull)
  variantId String?

  @@map("order_items")
}

model Customer {
  id             String    @id @default(cuid())
  email          String    @unique
  firstName      String?
  lastName       String?
  hashedPassword String?
  phone          String?

  addresses Address[]
  orders    Order[]
  reviews   Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("customers")
}

model Address {
  id             String   @id @default(cuid())
  customer       Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerId     String
  type           String
  firstName      String
  lastName       String
  addressLine1   String
  addressLine2   String?
  city           String
  state          String
  postalCode     String
  country        String
  isDefault      Boolean  @default(false)

  @@map("customer_addresses")
}

model Review {
  id         String   @id @default(cuid())
  rating     Int
  comment    String?
  isVerified Boolean  @default(false)
  isApproved Boolean  @default(false)

  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId  String
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  customerId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([productId, customerId])
  @@map("reviews")
}

model DashboardUser {
  id             String            @id @default(cuid())
  email          String            @unique
  hashedPassword String
  firstName      String?
  lastName       String?
  role           DashboardUserRole @default(STAFF)
  isActive       Boolean           @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("dashboard_users")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
  FAILED
}

enum DashboardUserRole {
  OWNER
  ADMIN
  STAFF
}